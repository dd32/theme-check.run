FROM docker:dind

ENV DOCKER_HOST="unix:///var/run/docker.sock"

RUN mkdir /etc/docker && \
	echo {\"graph\":\"/docker-storage\",\"registry-mirrors\":[\"http://registry\"]} > /etc/docker/daemon.json

RUN apk update && \
	apk add --no-cache docker-compose git subversion openssh-client nodejs npm curl

RUN git clone https://github.com/WordPress/theme-review-action.git /theme-review-action && \
	cd /theme-review-action && \
	npm install

# Testing only.
RUN svn export https://themes.svn.wordpress.org/twentyten/3.3/ /theme-review-action/test-theme

RUN date > /.builddate

COPY run-entrypoint.sh /entrypoint.sh

ENTRYPOINT /entrypoint.sh