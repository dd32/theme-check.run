FROM docker:dind

RUN apk update && apk add --no-cache docker-compose git subversion openssh-client nodejs npm curl

ENV DOCKER_HOST="unix:///var/run/docker.sock"

COPY dockerfiles/run-with-docker.sh /run-with-docker.sh

# Cache needed images - Can't be done as we can't run in priv mode before container boot.
# RUN /run-with-docker.sh docker pull mariadb && \
#	/run-with-docker.sh docker pull wordpress && \
#	/run-with-docker.sh docker pull wordpress:cli && \
#	/run-with-docker.sh docker pull composer && \
#	/run-with-docker.sh docker pull wordpressdevelop/phpunit:latest

RUN git clone https://github.com/WordPress/theme-review-action.git /theme-review-action && \
	cd /theme-review-action && \
	npm install

RUN svn export https://themes.svn.wordpress.org/twentyten/3.3/ /theme-review-action/test-theme

CMD /run-with-docker.sh
